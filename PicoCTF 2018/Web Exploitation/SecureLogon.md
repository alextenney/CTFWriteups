# Secure Logon

CTF: PicoCTF 2018. 
Category: Web Exploitation
Points: 500
Description: Uh oh, the login page is more secure... I think. http://2018shell.picoctf.com:13747 (link [1] ). 
Source [2] .
Hint(s):(1) There are versions of AES that really aren't secure.
Author: Alexandra Tenney

## Solution

Sometimes, cookies are encoded using a cipher so the user can't mess with them... just as we have done on here in the past.
We can login with anything, but cannot access the flag. The bottom of the screen indicates theres a cookie being stored, so I use my
chrome extension "Edit this Cookie" to check. Its clearly been disguised, as  {'admin': 0, 'username': 'a', 'password': 'a'} becomes
fq45FTVfN5QMN9DWqr2pnqvMCdg3UKpyoVcGRvoL7TtY35EH0MMu1wdjHX1gth2fA4WHuPIK4ANBK0qc+RFlwg==. We can use a small python program to decode
this!

This code was adapted from k3d4r in his own write up for this challenge. 

```
from base64 import b64encode, b64decode
from sys import argv


def xor(a, b):
    """
    return a bytearray constructed by XORing a and b
    """
    out = bytearray()
    for i,c in enumerate(a):
        out.append(c ^ b[i])
    return bytes(out)


def construct_cookie(cookie_value):
    # current and desired plaintext, obtained by observing the cookie
    desired_plaintext = bytearray('{"admin": 0, "pa', 'utf8')
    current_plaintext = bytearray('{"admin": 1, "pa', 'utf8')
    # base64-decode the cookie value
    decoded_cookie = b64decode(cookie_value)
    # split the IV and the message
    original_iv = decoded_cookie[:16]
    # construct the mask for the first block
    desired_iv = xor(xor(desired_plaintext, current_plaintext), bytearray(original_iv))
    # prepend the new IV to the original ciphertext
    altered_ciphertext = desired_iv+decoded_cookie[16:]
    # base64-encode the cookie value
    cookie = b64encode(altered_ciphertext).decode("utf8")
    return cookie


if __name__ == '__main__':
    try:
        cookie = argv[1]
    except IndexError:
        print(f'usage: {argv[0]} [COOKIE]')
    print(construct_cookie(cookie))
```

When the program runs, it takes the encrypted cookie as an argument, and splits it so it is only dealing with the admin section, changing
the 0 to a 1. Then the program will output a new encrypted cookie which you can replace with the old. Refresh the page and you'll have the
flag!

## The Full Flag

picoCTF{fl1p_4ll_th3_bit3_7d7c2296}
